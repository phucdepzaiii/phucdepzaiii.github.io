<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng B·∫Øt B√†i V2.2 (Ch·∫ø ƒê·ªô Tinh Anh)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #F9FAFB;
        }
        .golden-signal {
            background: linear-gradient(145deg, #4a3a0a, #a0821c);
            border: 2px solid #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            animation: golden-pulse 2s infinite;
        }
        @keyframes golden-pulse {
            0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
            100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
        }
        .no-signal {
            background-color: #374151; /* gray-700 */
            border: 2px solid #4B5563; /* gray-600 */
        }
        .history-item {
            transition: background-color 0.3s;
        }
        .history-item.win {
            background-color: rgba(59, 130, 246, 0.2); /* blue */
        }
        .history-item.loss {
            background-color: rgba(239, 68, 68, 0.2); /* red */
        }
        /* Big Road Styles */
        #bigRoadDisplay {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 2.5rem; /* 40px */
            gap: 2px;
            overflow-x: auto;
            padding: 8px;
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }
        #bigRoadDisplay::-webkit-scrollbar { height: 6px; }
        #bigRoadDisplay::-webkit-scrollbar-track { background: #1f2937; }
        #bigRoadDisplay::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .road-col {
            display: grid;
            grid-auto-rows: 2.5rem; /* 40px */
            gap: 2px;
        }
        .road-item {
            width: 2.5rem; /* 40px */
            height: 2.5rem; /* 40px */
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.125rem; /* 18px */
            color: white;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-5 gap-6">
        <!-- Left Column: Signal & History -->
        <div class="lg:col-span-3 space-y-6">
            <!-- Header -->
            <div class="bg-gray-800 p-4 rounded-2xl shadow-lg text-center">
                <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">H·ªá Th·ªëng B·∫Øt B√†i V2.2 (Ch·∫ø ƒê·ªô Tinh Anh)</h1>
                <p class="text-gray-400 mt-1">Ch·ªâ Ph√°n ƒêo√°n Khi G·∫∑p T√≠n Hi·ªáu V√†ng</p>
            </div>

            <!-- Signal Display -->
            <div id="signal-display" class="p-8 rounded-2xl text-center transition-all duration-500 no-signal">
                <div id="signal-content">
                    <i class="fas fa-search text-6xl text-gray-500 mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-400">ƒêang ch·ªù t√≠n hi·ªáu...</h2>
                    <p class="text-gray-500 mt-2">Nh·∫≠p k·∫øt qu·∫£ ƒë·ªÉ h·ªá th·ªëng t√¨m ki·∫øm c∆° h·ªôi.</p>
                </div>
            </div>

            <!-- History Display -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-blue-300">üìú B·∫£ng C·∫ßu Big Road</h2>
                    <span class="text-gray-400 font-medium">T·ªïng: <span id="totalGames">0</span> v√°n</span>
                </div>
                <div class="bg-gray-900 rounded-lg min-h-[280px] border border-gray-700">
                    <div id="bigRoadDisplay">
                        <p class="text-gray-500 p-4">Ch∆∞a c√≥ k·∫øt qu·∫£...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Controls, Stats, History -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Input Section -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-blue-300">üé≤ Nh·∫≠p K·∫øt Qu·∫£</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <button onclick="addResult('P')" class="py-5 text-xl font-bold bg-blue-600 hover:bg-blue-500 rounded-lg transition">PLAYER</button>
                    <button onclick="addResult('B')" class="py-5 text-xl font-bold bg-red-600 hover:bg-red-500 rounded-lg transition">BANKER</button>
                </div>
                <div class="flex gap-4">
                    <button onclick="undoLast()" class="flex-1 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg transition">‚Ü©Ô∏è Ho√†n T√°c</button>
                    <button onclick="clearHistory()" class="flex-1 py-3 bg-yellow-600 hover:bg-yellow-500 rounded-lg transition">üóëÔ∏è X√≥a L·ªãch S·ª≠</button>
                </div>
            </div>

            <!-- Stats -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-green-300">üéØ Th·ªëng K√™ "T√≠n Hi·ªáu V√†ng"</h2>
                 <div class="space-y-4">
                    <div class="flex justify-between items-center bg-gray-700/50 p-3 rounded-lg">
                        <span class="font-medium text-gray-300">T·ª∑ L·ªá Th·∫Øng</span>
                        <span id="accuracyRate" class="text-2xl font-bold text-green-400">0.0%</span>
                    </div>
                    <div class="flex justify-between items-center bg-gray-700/50 p-3 rounded-lg">
                        <span class="font-medium text-gray-300">Th·∫Øng / T·ªïng</span>
                        <div>
                            <span id="correctPredictions" class="text-lg font-semibold text-white">0</span>
                            <span class="text-gray-400">/</span>
                            <span id="totalPredictions" class="text-lg font-semibold text-white">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Signal History -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-yellow-300">üìú L·ªãch S·ª≠ T√≠n Hi·ªáu V√†ng</h2>
                <div class="space-y-2 max-h-96 overflow-y-auto pr-2" id="signalHistoryContainer">
                    <p class="text-gray-500 text-center py-4">Ch∆∞a c√≥ t√≠n hi·ªáu n√†o ƒë∆∞·ª£c ghi nh·∫≠n.</p>
                </div>
            </div>

             <!-- Data Management -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                 <h2 class="text-xl font-semibold mb-4 text-purple-300">üìÅ D·ªØ Li·ªáu</h2>
                 <div class="flex flex-col gap-4">
                    <button onclick="exportData()" class="w-full py-3 bg-sky-600 hover:bg-sky-500 rounded-lg transition">üì§ Xu·∫•t D·ªØ Li·ªáu</button>
                    <button onclick="document.getElementById('fileInput').click()" class="w-full py-3 bg-purple-600 hover:bg-purple-500 rounded-lg transition">üì• Nh·∫≠p D·ªØ Li·ªáu</button>
                    <input type="file" id="fileInput" class="hidden" accept=".json" onchange="importData(event)">
                </div>
            </div>
        </div>
    </div>

<script>
let state = {
    history: [],
    predictions: []
};

// --- CORE LOGIC: NEW ELITE RULES V2.1 ---
const expertRules = [
    { name: "B·∫ª B·ªát 2 Tr·∫£ 1 (PP->B)", pattern: ['P', 'P'], prediction: 'B' },
    { name: "B·∫ª B·ªát 2 Tr·∫£ 1 (BB->P)", pattern: ['B', 'B'], prediction: 'P' },
    { name: "C·∫ßu 1-1-2 (PBPB->B)", pattern: ['P', 'B', 'P', 'B'], prediction: 'B' },
    { name: "C·∫ßu 1-1-2 (BPBP->P)", pattern: ['B', 'P', 'B', 'P'], prediction: 'P' },
    { name: "B·ªát 3 Tr·∫£ B·ªát 2 (PPPBB->B)", pattern: ['P', 'P', 'P', 'B', 'B'], prediction: 'B' },
    { name: "B·ªát 3 Tr·∫£ B·ªát 2 (BBBPP->P)", pattern: ['B', 'B', 'B', 'P', 'P'], prediction: 'P' }
];

function checkAllRules(currentHistory) {
    for (const rule of expertRules) {
        if (currentHistory.length < rule.pattern.length) continue;
        
        const segment = currentHistory.slice(-rule.pattern.length);
        const isMatch = segment.every((val, index) => val === rule.pattern[index]);

        if (isMatch) {
            return {
                prediction: rule.prediction,
                ruleName: rule.name
            };
        }
    }
    return null; // No rule matched
}


// --- UI UPDATE FUNCTIONS ---
function updateSignalUI(signal = null) {
    const displayDiv = document.getElementById('signal-display');
    const contentDiv = document.getElementById('signal-content');

    if (signal) {
        displayDiv.classList.remove('no-signal');
        displayDiv.classList.add('golden-signal');
        
        const resultText = signal.prediction === 'P' ? 'PLAYER' : 'BANKER';
        const icon = signal.prediction === 'P' ? 'üë§' : 'üè¶';
        
        contentDiv.innerHTML = `
            <i class="fas fa-star text-6xl text-yellow-300 mb-4"></i>
            <h2 class="text-3xl font-bold text-white">T√çN HI·ªÜU V√ÄNG!</h2>
            <p class="text-yellow-200 mt-2 mb-4 text-lg">Ph√°t hi·ªán quy lu·∫≠t: <br><strong>${signal.ruleName}</strong></p>
            <div class="bg-black/30 rounded-lg p-4">
                <p class="text-xl text-white">ƒê·ªÅ xu·∫•t:</p>
                <p class="text-5xl font-extrabold text-white mt-1">${icon} ${resultText}</p>
            </div>
        `;
    } else {
        displayDiv.classList.add('no-signal');
        displayDiv.classList.remove('golden-signal');
        contentDiv.innerHTML = `
            <i class="fas fa-search text-6xl text-gray-500 mb-4"></i>
            <h2 class="text-3xl font-bold text-gray-400">ƒêang ch·ªù t√≠n hi·ªáu...</h2>
            <p class="text-gray-500 mt-2">Nh·∫≠p k·∫øt qu·∫£ ƒë·ªÉ h·ªá th·ªëng t√¨m ki·∫øm c∆° h·ªôi.</p>
        `;
    }
}

function updateStatsUI() {
    const total = state.predictions.length;
    if (total === 0) {
        document.getElementById('accuracyRate').textContent = 'N/A';
        document.getElementById('correctPredictions').textContent = '0';
        document.getElementById('totalPredictions').textContent = '0';
        return;
    }
    const correct = state.predictions.filter(p => p.predicted === p.actual).length;
    const rate = (correct / total) * 100;

    document.getElementById('accuracyRate').textContent = `${rate.toFixed(1)}%`;
    document.getElementById('correctPredictions').textContent = correct;
    document.getElementById('totalPredictions').textContent = total;
}

function updateSignalHistoryUI() {
    const container = document.getElementById('signalHistoryContainer');
    if (state.predictions.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">Ch∆∞a c√≥ t√≠n hi·ªáu n√†o ƒë∆∞·ª£c ghi nh·∫≠n.</p>';
        return;
    }

    container.innerHTML = '';
    [...state.predictions].reverse().forEach((p, index) => {
        const isWin = p.predicted === p.actual;
        const resultClass = isWin ? 'win' : 'loss';
        const icon = isWin ? '<i class="fas fa-check-circle text-green-400"></i>' : '<i class="fas fa-times-circle text-red-400"></i>';
        
        const item = document.createElement('div');
        item.className = `history-item ${resultClass} p-3 rounded-lg flex justify-between items-center`;
        item.innerHTML = `
            <div class="flex-grow">
                <p class="text-xs text-gray-400">L·∫ßn ${state.predictions.length - index} - ${p.ruleName}</p>
                <p class="font-semibold text-white">D·ª± ƒëo√°n: ${p.predicted} | K·∫øt qu·∫£: ${p.actual}</p>
            </div>
            <div class="text-2xl ml-4">${icon}</div>
        `;
        container.appendChild(item);
    });
}

function updateBigRoadUI() {
    const history = state.history || [];
    const roadDiv = document.getElementById('bigRoadDisplay');
    document.getElementById('totalGames').textContent = history.length;

    if (history.length === 0) {
        roadDiv.innerHTML = '<p class="text-gray-500 p-4">Ch∆∞a c√≥ k·∫øt qu·∫£...</p>';
        roadDiv.style.display = 'block';
        return;
    }
    roadDiv.style.display = 'grid';
    roadDiv.innerHTML = '';

    const columns = [];
    if (history.length > 0) {
        let currentCol = [history[0]];
        for (let i = 1; i < history.length; i++) {
            if (history[i] === history[i-1]) {
                currentCol.push(history[i]);
            } else {
                columns.push(currentCol);
                currentCol = [history[i]];
            }
        }
        columns.push(currentCol);
    }

    columns.forEach(colData => {
        const colDiv = document.createElement('div');
        colDiv.className = 'road-col';
        colData.forEach(item => {
            const itemDiv = document.createElement('div');
            const bgColor = item === 'P' ? 'bg-blue-600' : 'bg-red-600';
            itemDiv.className = `road-item ${bgColor}`;
            itemDiv.textContent = item;
            colDiv.appendChild(itemDiv);
        });
        roadDiv.appendChild(colDiv);
    });

    roadDiv.scrollLeft = roadDiv.scrollWidth;
}


// --- EVENT HANDLERS & ACTIONS ---
function addResult(result) {
    const lastPrediction = checkAllRules(state.history);

    if (lastPrediction) {
        state.predictions.push({
            predicted: lastPrediction.prediction,
            actual: result,
            ruleName: lastPrediction.ruleName
        });
    }

    state.history.push(result);
    saveState();
    
    const newSignal = checkAllRules(state.history);
    updateSignalUI(newSignal);
    updateStatsUI();
    updateSignalHistoryUI();
    updateBigRoadUI();
}

function undoLast() {
    if (state.history.length === 0) return;

    const historyBeforeLastResult = state.history.slice(0, -1);
    const wasSignalBefore = checkAllRules(historyBeforeLastResult);
    
    if (wasSignalBefore) {
        if (state.predictions.length > 0) {
            state.predictions.pop();
        }
    }

    state.history.pop();
    
    saveState();

    const newSignal = checkAllRules(state.history);
    updateSignalUI(newSignal);
    updateStatsUI();
    updateSignalHistoryUI();
    updateBigRoadUI();
}

function clearHistory() {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ v√† th·ªëng k√™ c·ªßa phi√™n n√†y kh√¥ng?')) {
        state.history = [];
        state.predictions = [];
        saveState();
        updateSignalUI(null);
        updateStatsUI();
        updateSignalHistoryUI();
        updateBigRoadUI();
    }
}


// --- DATA MANAGEMENT ---
function saveState() {
    localStorage.setItem('baccaratExpertState_v2.2', JSON.stringify(state));
}

function loadState() {
    const savedState = localStorage.getItem('baccaratExpertState_v2.2');
    if (savedState) {
        state = JSON.parse(savedState);
    }
}

function exportData() {
    if (state.history.length === 0) {
        alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t.");
        return;
    }
    const dataStr = JSON.stringify(state, null, 2);
    const dataBlob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.download = `baccarat_expert_v2.2_backup_${new Date().toISOString().slice(0,10)}.json`;
    link.href = url;
    link.click();
    URL.revokeObjectURL(url);
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedState = JSON.parse(e.target.result);
            if (!Array.isArray(importedState.history) || !Array.isArray(importedState.predictions)) {
                throw new Error("Invalid file format");
            }
            if (confirm('D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã ghi ƒë√®. B·∫°n c√≥ ch·∫Øc mu·ªën ti·∫øp t·ª•c?')) {
                state = importedState;
                saveState();
                initializeApp();
                alert('Nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng!');
            }
        } catch (error) {
            alert('L·ªói: File d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá.');
            console.error("Import error:", error);
        } finally {
            event.target.value = '';
        }
    };
    reader.readAsText(file);
}


// --- INITIALIZATION ---
function initializeApp() {
    loadState();
    const newSignal = checkAllRules(state.history);
    updateSignalUI(newSignal);
    updateStatsUI();
    updateSignalHistoryUI();
    updateBigRoadUI();
}

document.addEventListener('DOMContentLoaded', initializeApp);

</script>
</body>
</html>
